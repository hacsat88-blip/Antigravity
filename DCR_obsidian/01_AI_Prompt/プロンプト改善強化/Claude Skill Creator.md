# Skill Creator メタ指示（ベストプラクティス統合版）

> 以下をプロジェクトのカスタムインストラクションに配置する。
> Claude がスキル作成を依頼されたとき、公式 skill-creator の全工程を安定的に踏むための誘導プロンプトである。

---

## 1. 基本動作

ユーザーがスキルの作成・改善・評価を依頼した場合、必ず **最初に** `/mnt/skills/examples/skill-creator/SKILL.md` を `view` ツールで読み込み、公式のワークフローに従うこと。

ユーザーが与えたコンテキスト（会話履歴・添付ファイル・既存スキル）がある場合は、それを起点として意図を抽出し、インタビューの負担を減らすこと。

---

## 2. YAML フロントマターの安全な記述

SKILL.md の YAML フロントマターを記述する際は、構文エラーを防ぐために以下を厳守する。

**特殊文字を含む値は、必ずダブルクォーテーション `"..."` で囲む。**

対象文字: `:` `()` `[]` `{}` `#` `@` `%` `|` `&` `*`

```yaml
# ✅ 正しい例
---
name: my-skill
description: "Use when users need: (1) Planning (2) Analysis"
---

# ❌ 誤った例
---
name: my-skill
description: Use when users need: (1) Planning (2) Analysis
---
```

---

## 3. description はアンダートリガー対策を前提に書く

Claude はスキルを「控えめに」しか発火させない傾向がある。これを補うために、description フィールドは以下の方針で記述する。

- スキルが **何をするか** だけでなく、**どんな文脈で使うべきか** を具体的に列挙する
- ユーザーがスキル名やファイル形式を明示しなくても発火するよう、関連するキーワード・ユースケースを含める
- 迷ったら「やや積極的」に寄せる。発火しないより、発火して不要だった方が損失が小さい

```yaml
# ✅ 積極的な description の例
description: "Word文書(.docx)の作成・編集・読み取り・操作に使用する。トリガー対象: Word doc、.docx、レポート、メモ、レター、テンプレートなどの言及。ユーザーが文書形式を明示していなくても、ビジネス文書や報告書の作成依頼であればこのスキルを使用すること。"
```

---

## 4. 指示の書き方：WHY を添え、MUST/NEVER を控える

スキル本文の指示は、モデルの理解を促す記述を優先する。

- 「なぜそうするのか」を説明すれば、モデルは未知のケースにも適切に対応できる
- `MUST` `NEVER` `ALWAYS` の多用は、過剰な制約となり、柔軟性を損なう
- どうしても厳格なルールが必要な場合のみ使い、その場合も理由を添える

```markdown
# ✅ WHY を添えた指示
出力ファイル名にはタイムスタンプを含める。
同名ファイルの上書き事故を防ぐためである。

# ❌ 理由なしの MUST
出力ファイル名には MUST タイムスタンプを含めること。
```

---

## 5. Progressive Disclosure（段階的開示）を設計する

スキルには3層の情報階層がある。これを意識して構造化する。

| 層 | 内容 | 読み込みタイミング | 目安 |
|---|---|---|---|
| **第1層** | name + description（フロントマター） | 常にコンテキスト内 | 約100語 |
| **第2層** | SKILL.md 本文 | スキル発火時 | 500行以内 |
| **第3層** | references/ scripts/ assets/ | 必要時に明示的に読み込み | 制限なし |

**運用指針**

- SKILL.md 本文が500行を超えそうな場合は、詳細を `references/` に分割し、SKILL.md からは「どのファイルを・いつ読むか」のポインタだけ記述する
- 300行を超える参照ファイルには目次を付ける
- ドメイン別のバリアントがある場合（例: AWS / GCP / Azure）は、参照ファイルを分けて必要なものだけ読ませる

---

## 6. スキルのディレクトリ構造

```
skill-name/
├── SKILL.md              （必須）フロントマター + 指示本文
├── scripts/              （任意）決定的・反復的な処理の実行コード
├── references/           （任意）必要時にコンテキストへ読み込むドキュメント
└── assets/               （任意）出力に使うテンプレート・アイコン・フォントなど
```

**含めないもの**: README.md、INSTALLATION_GUIDE.md、CHANGELOG.md など人間向けのドキュメント。スキルの読み手は AI エージェントである。

---

## 7. テストケースとフィードバックループ

スキルのドラフトを書いたら、以下の流れで品質を検証する。

1. **2〜3個の現実的なテストプロンプト** を作成する。実際のユーザーが入力しそうな具体的な文面にする
2. テストプロンプトをユーザーに確認してもらう
3. **すぐに実行する**。仕様が完全でなくても、動かして出力を見せることで要件が明確になる
4. 出力を確認し、スキルを修正する
5. 納得できるまで繰り返す

客観的に評価可能な出力（ファイル変換、データ抽出、コード生成など）には `evals/evals.json` を作成し、自動評価を活用する。主観的な出力（文体、デザインなど）はユーザーの手動評価でよい。

---

## 8. Description Optimization（トリガー精度の最適化）

スキルの作成・改善が完了した後、description の発火精度を最適化する工程を提案する。

1. **should-trigger / should-not-trigger の評価クエリ** を各8〜10件生成する
2. should-trigger は多様な言い回し・暗黙的なニーズを含める
3. should-not-trigger は「キーワードは似ているが別の処理が適切」な近接ケースを重視する
4. ユーザーに確認後、最適化ループ（`scripts/run_loop.py`）を実行する

---

## 9. 改善時の原則

既存スキルを改善する場合は、以下を守る。

- **特定のテストケースへの過学習を避ける**。個別の修正ではなく、一般化可能なパターンとして改善する
- **効いていない指示は削る**。トランスクリプトを読み、モデルが無駄な作業に時間を使っている箇所があれば、その原因となる指示を除去する
- **最良バージョンを追跡する**。最新版ではなく、評価結果が最も良かったバージョンを保持する

---

## 10. 完了時の提示

`present_files` ツールが利用可能な場合は、`scripts/package_skill.py` でパッケージ化し、`.skill` ファイルとしてユーザーに提示する。