# addons_prompt_engineering

> Version: v1.0  
> Last updated: 2026-02-17  
> Changelog: 初版。Anthropic公式ドキュメント・OpenAI公式ガイド・Google Gemini公式ガイドを一次ソースとして作成。  
> 適用先: Prompt Editorial Lab v6.0 の Execute（再設計）節・モデル固有ガイダンス節を補強する addons。

---

## 使い方

このファイルは **原則層** と **手法カタログ層** の2層構造。

- プロンプト生成・再設計時は原則層を参照する。
- 特定テクニックの詳細が必要な場合のみ手法カタログ層を参照する。

---

## 原則層（常時参照）

### テクニック × 適用条件 × 効果・リスク

| # | テクニック | 適用条件 | 効果 | リスク・限界 | 信頼度 |
| --- | --- | --- | --- | --- | --- |
| 1 | 明確・直接的な指示 | 常時 | 精度・一貫性の基盤 | 過少指定では抜け漏れ | Fact |
| 2 | 背景・理由の明示（Why） | 判断余地を残したいとき | モデルが意図を類推して補完 | 長くなると指示が埋もれる | Fact |
| 3 | Few-shot（Multishot）例示 | 出力形式・トーンを制御したいとき | 形式遵守率が大幅に向上 | 例が偏ると過学習的な出力になる | Fact |
| 4 | Negative example の追加 | 境界条件を厳密に制御したいとき | 禁止パターンの明示で精度向上 | 肯定例より控えめに使う（Google推奨） | Fact |
| 5 | Chain of Thought（CoT） | 複雑な論理・多段階推論タスク | 精度・一貫性が上がる | Latency増加。単純タスクには不要 | Fact |
| 6 | Zero-shot CoT（"step by step"） | 推論モデルでない場合の代替 | CoTを誘発する最小コスト | 推論モデルには逆効果になる場合あり | Fact |
| 7 | XML タグによる構造化 | 複数要素（指示・例・文脈）が混在する場合 | パース精度が向上。Claudeで特に効果大 | タグ設計が一貫しないと逆効果 | Fact |
| 8 | 役割付与（Role Prompting） | 専門的トーン・視点が必要なとき | 文体・判断軸が安定する | 過剰な役割付与は自由度を奪う | Fact |
| 9 | 出力形式の明示 | JSON・表・箇条書きなど構造化出力が必要なとき | 形式遵守率が上がる | 推論モデルではMarkdown明示が必要 | Fact |
| 10 | Prefill（応答の先頭固定） | 出力の書き出しを強制したいとき（Claude専用） | フォーマット逸脱を防ぐ | Claude以外では機能しない | Fact |
| 11 | Prompt Chaining | 複雑なタスクを分解したいとき | 精度・デバッグのしやすさが上がる | ステップ間の整合性管理が必要 | Fact |
| 12 | 並列実行（Parallel Prompting） | 独立したサブタスクが複数あるとき | レイテンシを大幅に削減できる | 結果の統合ロジックが必要 | Fact |
| 13 | ReAct パターン | Tool use・エージェント型ワークフロー | 推論と行動を組み合わせた精度向上 | プロンプト設計が複雑化する | 推定 |
| 14 | RAG（文脈内検索補強） | 独自知識・最新情報が必要なとき | ハルシネーション低減 | 推論モデルには過剰文脈が逆効果になる場合あり | Fact |
| 15 | Must / Must not の明示 | 禁止事項・必須事項がある場合 | 遵守率が上がる | 制約が多すぎると出力品質が下がる | Fact |
| 16 | Success criteria の定義 | 評価・検証が必要なプロダクション用プロンプト | 改善サイクルが回せる | 定義が曖昧だと評価できない | Fact |
| 17 | モデルスナップショット固定 | プロダクション環境 | 再現性・一貫性を確保 | バージョン間の差異吸収コストが生じる | Fact |

---

## モデル固有ガイダンス（手法カタログ層）

---

### Claude（Anthropic）

**特性：** XML タグへの親和性が高い。長い文脈での一貫性が強み。Claude 4.x は指示が明確なほど精度が上がる。

| やること | やらないこと |
| --- | --- |
| XML タグで指示・例・文脈を分離する | 曖昧な期待値を持ち込む（4.xは明示に基づいて動く） |
| thinking タグで推論を誘発する | 過剰な役割付与で判断軸を固定しすぎる |
| System Prompt に変わらない制約、User に可変入力を置く | "above and beyond" を暗黙的に期待する（4.xでは明示が必要） |
| Prefill で出力の書き出しを制御する | コンテキストを丸ごと流し込む（Context Rot の原因） |
| Adaptive Thinking を活用（claude-sonnet-4-5以降） | 推論モデルに "think step by step" を明示指示する |

**構造テンプレ（最小版）：**

```markdown
[System]
役割・制約・優先順位

[User]
<instructions>タスク詳細・出力形式</instructions>
<examples>
  <example>良い例</example>
</examples>
<context>入力データ・背景情報</context>
```

---

### o3 / o4-mini（OpenAI 推論モデル）

**特性：** 内部で推論するため、過剰な手順指示は逆効果。高レベルのゴールを与えて推論に任せる（"シニアエンジニアへの指示"イメージ）。

| やること | やらないこと |
| --- | --- |
| ゴールを短く・直接的に指示する | "Think step by step" を明示する（内部で行われているため不要、逆効果あり） |
| developer ロールでシステム指示を渡す（o1-2024-12-17以降） | 過剰な制約・詳細手順を列挙する |
| Markdown 出力が必要な場合は明示する | 出力フォーマットを暗黙的に期待する |
| RAG の場合は最も関連性の高い情報のみ渡す | 全文書を丸ごと投入する |
| reasoning_effort を用途に応じて設定する（low/medium/high） | 複雑なタスクに low を当てる |

---

### Gemini 3（Google）

**特性：** Gemini 2.x より直接指示への追従精度が向上。短く・直接的・構造的なプロンプトが最適。デフォルトで簡潔な応答。

| やること | やらないこと |
| --- | --- |
| タスクを1文で述べ、出力形式を1行で指定する | Gemini 2.x 用の冗長なガードレールをそのまま流用する |
| XML タグまたは Markdown 見出しで構造化する（どちらかに統一） | 同一プロンプト内でフォーマットを混在させる |
| Temperature はデフォルト（1.0）のまま使う | Temperature を下げる（ループ・品質低下のリスク） |
| マルチモーダル入力は具体的な質問と出力形式をセットで指定する | 「この画像を分析して」のみで渡す |
| 会話的・詳細な出力が必要なら明示する | 詳細を暗黙的に期待する |
| "do not infer" 等の広すぎる否定制約は避け「この情報から推論せよ」と肯定表現にする | 否定制約を乱用する |

---

### 汎用フォールバック（モデル不明・クロスプラットフォーム）

モデルが特定できない場合の最小安全設計：

1. タスクを1行で明示する（What + Why）
2. 出力形式を明示する（構造・長さ・スタイル）
3. 2〜3例の Few-shot を examples タグで囲む
4. Must / Must not を箇条書きで置く
5. 変わらない制約は System に、変わる入力は User に分離する

---

## 事故パターンと対策（共通）

| パターン | 原因 | 対策 |
| --- | --- | --- |
| 指示の埋没 | 文脈が長すぎて指示が後方に押し込まれた | 指示は先頭。文脈は圧縮して後ろに置く |
| 形式崩れ | 出力形式が曖昧 | Few-shot で形式例を示す + 明示指定 |
| ハルシネーション | 根拠なき断定 | RAG / 参照優先 / Unknown の明示を徹底 |
| 推論モデルへの過剰指示 | CoT・詳細手順を書きすぎた | ゴールのみ渡してモデルに任せる |
| 評価できない | 成功条件が未定義 | Prompt 作成前に success criteria を定める |

---

## v6.0 との接続マップ

| このファイルの節 | v6.0 の接続箇所 |
| --- | --- |
| 原則層テーブル（#1〜17） | Execute（再設計）節のテクニック選択 |
| モデル固有ガイダンス（Claude） | モデル固有ガイダンス Claude 行を拡充 |
| モデル固有ガイダンス（o3/o4-mini） | モデル固有ガイダンス o3/o4-mini 行を拡充 |
| モデル固有ガイダンス（Gemini 3） | モデル固有ガイダンス Gemini 行を拡充 |
| 汎用フォールバック | フォールバック節の技術的根拠 |
| 事故パターンと対策 | Critique（検証）節の失敗パターン補強 |

---

## 参照元（一次ソース）

- **Fact：** Anthropic公式ドキュメント `docs.anthropic.com/en/docs/build-with-claude/prompt-engineering/`（2026-02取得）
- **Fact：** OpenAI 公式ガイド `platform.openai.com/docs/guides/prompt-engineering` および `reasoning-best-practices`（2026-02取得）
- **Fact：** Google Vertex AI Gemini 3 prompting guide `docs.cloud.google.com/vertex-ai/generative-ai/docs/start/gemini-3-prompting-guide`（2026-02取得）
- **Fact：** Google AI for Developers `ai.google.dev/gemini-api/docs/prompting-strategies`（2026-02取得）
- **推定：** o3/o4-mini tool use ガイド `cookbook.openai.com` ― 実務報告ベース（ReAct パターンの評価）

---

## 改訂ルール

- モデルファミリーが更新された場合、該当モデルの節のみを差し替える（他の節に影響しない）
- 新テクニックの追加は Impact > Cost の場合のみ。Change Budget：新規行 最大3行/改訂
- Fact / 推定 / 仮説 / Unknown の分類ラベルを必ず維持する

---

*このファイルは Prompt Editorial Lab v6.0 の addons として機能します。正本 canonical の優先順位・衝突処理に従ってください。*
